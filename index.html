<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Management System</title>
    <style>
        /* Simple styling for the system */
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 10px;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            padding: 5px 10px;
            margin: 2px;
        }
    </style>
</head>
<body>

    <h1>Vehicle Management System</h1>

    <!-- Login Form -->
    <div id="loginDiv">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Enter Email"><br><br>
        <button onclick="login()">Login</button>
    </div>

    <!-- System Main Interface -->
    <div id="mainDiv" style="display:none;">
        <button onclick="logout()">Logout</button>
        <h2>Manage Vehicles</h2>
        
        <!-- Vehicle Management Table -->
        <table id="vehicleTable">
            <thead>
                <tr>
                    <th>Vehicle Name</th>
                    <th>Driver</th>
                    <th>Start Date</th>
                    <th>Start Time</th>
                    <th>End Date</th>
                    <th>End Time</th>
                    <th>Assigned To</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Vehicle rows will be dynamically populated -->
            </tbody>
        </table>

        <br>

        <!-- Add New Vehicle Form -->
        <h3>Add New Vehicle</h3>
        <input type="text" id="vehicleName" placeholder="Vehicle Name">
        <select id="driverDropdown">
            <!-- Drivers will be dynamically populated -->
        </select>
        <input type="date" id="startDate">
        <input type="time" id="startTime">
        <input type="date" id="endDate">
        <input type="time" id="endTime">
        <button onclick="addVehicle()">Add Vehicle</button>

        <br><br>
        
        <!-- Dropdown to Select User to Assign Vehicle -->
        <select id="userDropdown">
            <!-- Users will be dynamically populated -->
        </select>
    </div>

    <script>
        // Sample users for the system
        const users = [
            'TMokitimi@jhpiego.org',
            'MLichaba@jhpiego.org',
            'TMokhele@jhpiego.org'
        ];

        // Sample drivers for the system
        const drivers = [
            'Driver 1',
            'Driver 2',
            'Driver 3'
        ];

        // State management for logged-in user and vehicles
        let loggedInUser = null;
        let vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];

        // Load users and drivers into dropdowns
        window.onload = () => {
            const userDropdown = document.getElementById('userDropdown');
            users.forEach(user => {
                let option = document.createElement('option');
                option.value = user;
                option.innerText = user;
                userDropdown.appendChild(option);
            });

            const driverDropdown = document.getElementById('driverDropdown');
            drivers.forEach(driver => {
                let option = document.createElement('option');
                option.value = driver;
                option.innerText = driver;
                driverDropdown.appendChild(option);
            });

            renderVehicles();
        };

        // Login function
        function login() {
            const email = document.getElementById('email').value;
            if (users.includes(email)) {
                loggedInUser = email;
                document.getElementById('loginDiv').style.display = 'none';
                document.getElementById('mainDiv').style.display = 'block';
            } else {
                alert('Invalid email address');
            }
        }

        // Logout function
        function logout() {
            loggedInUser = null;
            document.getElementById('loginDiv').style.display = 'block';
            document.getElementById('mainDiv').style.display = 'none';
        }

        // Function to render vehicles in the table
        function renderVehicles() {
            const tbody = document.querySelector('#vehicleTable tbody');
            tbody.innerHTML = '';
            vehicles.forEach((vehicle, index) => {
                const tr = document.createElement('tr');

                tr.innerHTML = `
                    <td>${vehicle.name}</td>
                    <td>${vehicle.driver}</td>
                    <td>${vehicle.startDate}</td>
                    <td>${vehicle.startTime}</td>
                    <td>${vehicle.endDate}</td>
                    <td>${vehicle.endTime}</td>
                    <td>
                        <select onchange="updateAssignedUser(${index}, this.value)">
                            ${users.map(user => `<option value="${user}" ${user === vehicle.assignedTo ? 'selected' : ''}>${user}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <button onclick="editVehicle(${index})">Edit</button>
                        <button onclick="deleteVehicle(${index})">Delete</button>
                    </td>
                `;

                tbody.appendChild(tr);
            });
        }

        // Function to add a new vehicle
        function addVehicle() {
            const vehicleName = document.getElementById('vehicleName').value;
            const driver = document.getElementById('driverDropdown').value;
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;
            const assignedTo = document.getElementById('userDropdown').value;

            if (vehicleName && driver && startDate && startTime && endDate && endTime && assignedTo) {
                vehicles.push({
                    name: vehicleName,
                    driver: driver,
                    startDate: startDate,
                    startTime: startTime,
                    endDate: endDate,
                    endTime: endTime,
                    assignedTo: assignedTo
                });
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                renderVehicles();
            } else {
                alert('Please fill out all fields.');
            }
        }

        // Function to update the assigned user
        function updateAssignedUser(index, user) {
            vehicles[index].assignedTo = user;
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
        }

        // Function to edit an existing vehicle
        function editVehicle(index) {
            const vehicle = vehicles[index];
            document.getElementById('vehicleName').value = vehicle.name;
            document.getElementById('driverDropdown').value = vehicle.driver;
            document.getElementById('startDate').value = vehicle.startDate;
            document.getElementById('startTime').value = vehicle.startTime;
            document.getElementById('endDate').value = vehicle.endDate;
            document.getElementById('endTime').value = vehicle.endTime;
            document.getElementById('userDropdown').value = vehicle.assignedTo;

            // Remove the old entry
            deleteVehicle(index);
        }

        // Function to delete a vehicle
        function deleteVehicle(index) {
            vehicles.splice(index, 1);
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
            renderVehicles();
        }
    </script>

</body>
</html>
