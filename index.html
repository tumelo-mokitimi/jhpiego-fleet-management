<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jhpiego Vehicle Management System</title>
    <style>
      /* Styles unchanged */
    </style>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
  </head>
  <body>
    <div class="header">
      <img src="jhpiego_logo.png" alt="Jhpiego Logo" />
      <h1>Jhpiego Vehicle Management System</h1>
    </div>

    <!-- Login Form -->
    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>

    <button id="logoutButton" class="hidden">Logout</button>

    <!-- Admin Section -->
    <div id="adminSection" class="hidden">
      <!-- Add Vehicle Form -->
      <div class="section">
        <h2>Add New Vehicle</h2>
        <form id="addVehicleForm">
          <!-- Add Vehicle Form Inputs -->
        </form>
      </div>
      <!-- Vehicle List with Driver Assignment -->
      <div class="section">
        <h2>Vehicle List</h2>
        <table id="adminVehicleTable">
          <!-- Vehicle Table Structure -->
        </table>
      </div>
    </div>

    <!-- User Section -->
    <div id="userSection" class="hidden">
      <!-- Available Vehicles -->
      <div class="section">
        <h2>Available Vehicles</h2>
        <table id="userVehicleTable">
          <!-- User Vehicle Table Structure -->
        </table>
      </div>

      <!-- My Requests -->
      <div class="section">
        <h2>My Requests</h2>
        <table id="myRequestsTable">
          <!-- User Requests Table Structure -->
        </table>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      // JavaScript logic

      // Data Structures
      const vehicles = JSON.parse(localStorage.getItem("vehicles")) || [];
      const requests = JSON.parse(localStorage.getItem("requests")) || [];
      const users = [
        { email: "TMokitimi@jhpiego.org", role: "user" },
        { email: "MMatete@jhpiego.org", role: "user" },
        { email: "TNtelane@jhpiego.org", role: "user" },
        { email: "SMpalami@jhpiego.org", role: "user" },
        { email: "MShoba@jhpiego.org", role: "user" },
        { email: "TMolapo@jhpiego.org", role: "user" },
        { email: "RSoothoane@jhpiego.org", role: "user" },
        { email: "PMoshoeshoe@jhpiego.org", role: "user" },
        { email: "MTuoane@jhpiego.org", role: "user" },
        { email: "MNkongoane@jhpiego.org", role: "user" },
        { email: "TMakhaola@jhpiego.org", role: "user" },
        { email: "LMphafi@jhpiego.org", role: "user" },
        { email: "KMokone@jhpiego.org", role: "user" },
        { email: "SThamae@jhpiego.org", role: "user" },
        { email: "TNtene@jhpiego.org", role: "user" },
        { email: "TLekhiba@jhpiego.org", role: "user" },
        { email: "fleetmanager@jhpiego.org", role: "fleetManager" },
      ];
      let currentUser = { email: "", role: "" };

      // Utility Functions
      function generateId() {
        return "_" + Math.random().toString(36).substr(2, 9);
      }

      // Initialize the system
      function initialize() {
        populateAdminVehicleTable();
        populateUserVehicleTable();
        populateMyRequestsTable();
      }

      // Login Handling
      const loginForm = document.getElementById("loginForm");
      const adminSection = document.getElementById("adminSection");
      const userSection = document.getElementById("userSection");
      const logoutButton = document.getElementById("logoutButton");

      loginForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const emailInput = document.getElementById("email").value.trim();
        const passwordInput = document.getElementById("password").value.trim();

        if (!emailInput.endsWith("@jhpiego.org")) {
          alert("Only @jhpiego.org emails are allowed.");
          return;
        }

        currentUser.email = emailInput;
        const user = users.find((u) => u.email === emailInput);

        if (!user || passwordInput !== "password") {
          alert("Invalid credentials.");
          return;
        }

        currentUser.role = user.role;
        if (currentUser.role === "fleetManager") {
          adminSection.classList.remove("hidden");
          userSection.classList.add("hidden");
          populateAdminVehicleTable();
        } else {
          userSection.classList.remove("hidden");
          adminSection.classList.add("hidden");
          populateUserVehicleTable();
        }
        logoutButton.classList.remove("hidden");
        loginForm.classList.add("hidden");
      });

      // Logout Handling
      logoutButton.addEventListener("click", function () {
        currentUser = { email: "", role: "" };
        logoutButton.classList.add("hidden");
        loginForm.classList.remove("hidden");
        adminSection.classList.add("hidden");
        userSection.classList.add("hidden");
      });

      // Add New Vehicle Handling
      const addVehicleForm = document.getElementById("addVehicleForm");

      addVehicleForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const vehicle = {
          id: generateId(),
          make: document.getElementById("vehicleMake").value,
          model: document.getElementById("vehicleModel").value,
          registration: document.getElementById("vehicleRegistration").value,
          project: document.getElementById("projectName").value,
          destination: document.getElementById("destination").value,
          startDate: document.getElementById("startDate").value,
          startTime: document.getElementById("startTime").value,
          endDate: document.getElementById("endDate").value,
          endTime: document.getElementById("endTime").value,
          driver: "",
          assignedTo: "",
        };
        vehicles.push(vehicle);
        localStorage.setItem("vehicles", JSON.stringify(vehicles));
        populateAdminVehicleTable();
        addVehicleForm.reset();
      });

      // Populate Admin Vehicle Table
      function populateAdminVehicleTable() {
        const adminVehicleTableBody =
          document.querySelector("#adminVehicleTable tbody");
        adminVehicleTableBody.innerHTML = "";
        vehicles.forEach((vehicle) => {
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${vehicle.make}</td>
            <td>${vehicle.model}</td>
            <td>${vehicle.registration}</td>
            <td>${vehicle.project}</td>
            <td>${vehicle.destination}</td>
            <td>${vehicle.startDate}</td>
            <td>${vehicle.startTime}</td>
            <td>${vehicle.endDate}</td>
            <td>${vehicle.endTime}</td>
            <td></td>
            <td></td>
            <td>
              <!-- Actions -->
            </td>`;
          adminVehicleTableBody.appendChild(row);
        });
      }
    </script>
  </body>
</html>
