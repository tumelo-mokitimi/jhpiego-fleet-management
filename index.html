<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Management</title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style>
        /* Add your CSS styles here */
    </style>
</head>
<body>
    <h1>Vehicle Management</h1>
    <form id="vehicleForm">
        <input type="hidden" id="vehicleId">
        <label for="vehicleMake">Make:</label>
        <input type="text" id="vehicleMake" required>
        <label for="vehicleModel">Model:</label>
        <input type="text" id="vehicleModel" required>
        <label for="vehicleRegistration">Registration:</label>
        <input type="text" id="vehicleRegistration" required>
        <label for="projectName">Project Name:</label>
        <input type="text" id="projectName" required>
        <label for="destination">Destination:</label>
        <input type="text" id="destination" required>
        <label for="startDate">Start Date:</label>
        <input type="text" id="startDate" required>
        <label for="startTime">Start Time:</label>
        <input type="time" id="startTime" required>
        <label for="endDate">End Date:</label>
        <input type="text" id="endDate" required>
        <label for="endTime">End Time:</label>
        <input type="time" id="endTime" required>
        <label for="driver">Driver:</label>
        <select id="driver" required>
            <!-- Add driver options here -->
        </select>
        <button type="submit">Save Vehicle</button>
    </form>

    <h2>Vehicles</h2>
    <table id="vehicleTable">
        <thead>
            <tr>
                <th>Make</th>
                <th>Model</th>
                <th>Registration</th>
                <th>Project Name</th>
                <th>Destination</th>
                <th>Start Date</th>
                <th>Start Time</th>
                <th>End Date</th>
                <th>End Time</th>
                <th>Driver</th>
                <th>Assigned To</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Vehicle rows will be added here dynamically -->
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
        let vehicles = JSON.parse(localStorage.getItem("vehicles")) || [];
        const users = [
            { email: "TMokitimi@jhpiego.org" },
            { email: "MLichaba@jhpiego.org" },
            { email: "TMokhele@jhpiego.org" }
        ];

        // Initialize
        function initialize() {
            populateVehicleTable();
            document.getElementById("vehicleForm").addEventListener("submit", saveVehicle);
        }

        // Save Vehicle
        function saveVehicle(event) {
            event.preventDefault();

            const vehicleId = document.getElementById("vehicleId").value;
            const vehicle = {
                id: vehicleId ? parseInt(vehicleId) : Date.now(),
                make: document.getElementById("vehicleMake").value,
                model: document.getElementById("vehicleModel").value,
                registration: document.getElementById("vehicleRegistration").value,
                projectName: document.getElementById("projectName").value,
                destination: document.getElementById("destination").value,
                startDate: document.getElementById("startDate").value,
                startTime: document.getElementById("startTime").value,
                endDate: document.getElementById("endDate").value,
                endTime: document.getElementById("endTime").value,
                driver: document.getElementById("driver").value,
                assignedTo: document.querySelector("#vehicleForm select#driver").value
            };

            if (vehicleId) {
                vehicles = vehicles.map(v => v.id === vehicle.id ? vehicle : v);
            } else {
                vehicles.push(vehicle);
            }

            localStorage.setItem("vehicles", JSON.stringify(vehicles));
            populateVehicleTable();
            document.getElementById("vehicleForm").reset();
            document.getElementById("vehicleId").value = "";
        }

        // Populate Vehicle Table
        function populateVehicleTable() {
            const vehicleTableBody = document.querySelector("#vehicleTable tbody");
            vehicleTableBody.innerHTML = "";

            vehicles.forEach(vehicle => {
                const row = document.createElement("tr");

                Object.keys(vehicle).forEach(key => {
                    if (key !== "id") {
                        const cell = document.createElement("td");
                        if (key === "assignedTo") {
                            cell.appendChild(createAssignedToDropdown(vehicle.id, vehicle[key]));
                        } else {
                            cell.textContent = vehicle[key];
                        }
                        row.appendChild(cell);
                    }
                });

                const actionsCell = document.createElement("td");
                actionsCell.className = "button-group";
                const editButton = document.createElement("button");
                editButton.textContent = "Edit";
                editButton.addEventListener("click", () => editVehicle(vehicle.id));
                actionsCell.appendChild(editButton);

                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.addEventListener("click", () => deleteVehicle(vehicle.id));
                actionsCell.appendChild(deleteButton);

                row.appendChild(actionsCell);
                vehicleTableBody.appendChild(row);
            });
        }

        // Create Assigned To Dropdown
        function createAssignedToDropdown(vehicleId, selectedEmail) {
            const select = document.createElement("select");

            select.innerHTML = `
                <option value="" ${!selectedEmail ? "selected" : ""}>Select User</option>
                ${users.map(user => `
                    <option value="${user.email}" ${user.email === selectedEmail ? "selected" : ""}>${user.email}</option>
                `).join('')}
            `;

            select.addEventListener("change", function () {
                const selectedValue = this.value;
                vehicles = vehicles.map(vehicle => vehicle.id === vehicleId ? { ...vehicle, assignedTo: selectedValue } : vehicle);
                localStorage.setItem("vehicles", JSON.stringify(vehicles));
                populateVehicleTable();
            });

            return select;
        }

        // Edit Vehicle
        function editVehicle(vehicleId) {
            const vehicle = vehicles.find(vehicle => vehicle.id === vehicleId);
            if (vehicle) {
                document.getElementById("vehicleId").value = vehicle.id;
                document.getElementById("vehicleMake").value = vehicle.make;
                document.getElementById("vehicleModel").value = vehicle.model;
                document.getElementById("vehicleRegistration").value = vehicle.registration;
                document.getElementById("projectName").value = vehicle.projectName;
                document.getElementById("destination").value = vehicle.destination;
                document.getElementById("startDate").value = vehicle.startDate;
                document.getElementById("startTime").value = vehicle.startTime;
                document.getElementById("endDate").value = vehicle.endDate;
                document.getElementById("endTime").value = vehicle.endTime;
                document.getElementById("driver").value = vehicle.driver;
            }
        }

        // Delete Vehicle with confirmation
        function deleteVehicle(vehicleId) {
            if (confirm("Are you sure you want to delete this vehicle?")) {
                vehicles = vehicles.filter(vehicle => vehicle.id !== vehicleId);
                localStorage.setItem("vehicles", JSON.stringify(vehicles));
                populateVehicleTable();
            }
        }

        // Initialize Datepickers
        $(function () {
            $("#startDate, #endDate").datepicker({
                dateFormat: "dd-mm-yy"
            });
        });

        // Initial load
        initialize();
    </script>
</body>
</html>
