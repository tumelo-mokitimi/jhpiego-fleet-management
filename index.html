<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jhpiego Vehicle Management System</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #ffffff;
        margin: 0;
        padding: 20px;
      }
      .header {
        display: flex;
        align-items: center;
      }
      .header img {
        width: auto;
        height: auto;
        margin-right: 35px;
      }
      .header h1 {
        margin: 0;
        color: #000000;
      }
      form,
      .section {
        margin-bottom: 20px;
        padding: 20px;
        background-color: #f2f2f2;
        border-radius: 25px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      input,
      button,
      select {
        margin: 5px 0;
        padding: 10px;
        width: 100%;
        border: 1px solid #efefef;
        border-radius: 5px;
        box-sizing: border-box;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      table,
      th,
      td {
        border: 1px solid #ddd;
      }
      th,
      td {
        padding: 10px;
        text-align: left;
      }
      button {
        background-color: #016a63;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background-color: #039b91;
      }
      .button-group button {
        width: auto;
        margin-right: 5px;
      }
      .hidden {
        display: none;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
  </head>
  <body>
    <div class="header">
      <img src="jhpiego_logo.png" alt="Jhpiego Logo" />
      <h1>Jhpiego Vehicle Management System</h1>
    </div>

    <!-- Login Form -->
    <div id="loginDiv">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Enter Email"><br><br>
        <input type="password" id="password" placeholder="Enter Password"><br><br>
        <button onclick="login()">Login</button>
    </div>

    <!-- System Main Interface -->
    <div id="mainDiv" style="display:none;">
        <button onclick="logout()">Logout</button>
        <h2>Manage Vehicles</h2>
        
        <!-- Vehicle Management Table -->
        <table id="vehicleTable">
            <thead>
                <tr>
                    <th>Vehicle Name</th>
                    <th>Driver</th>
                    <th>Start Date</th>
                    <th>Start Time</th>
                    <th>End Date</th>
                    <th>End Time</th>
                    <th>Assigned To</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Vehicle rows will be dynamically populated -->
            </tbody>
        </table>

        <br>

        <!-- Add New Vehicle Form -->
        <h3>Add New Vehicle</h3>
        <input type="text" id="vehicleName" placeholder="Vehicle Name">
        <select id="driverDropdown">
            <!-- Drivers will be dynamically populated -->
        </select>
        <input type="date" id="startDate">
        <input type="time" id="startTime">
        <input type="date" id="endDate">
        <input type="time" id="endTime">
        <button onclick="addVehicle()">Add Vehicle</button>

        <br><br>
        
        <!-- Dropdown to Select User to Assign Vehicle -->
        <select id="userDropdown">
            <!-- Users will be dynamically populated -->
        </select>
    </div>

    <script>
        // Sample users with roles for the system
        const users = [
            { email: 'TMokitimi@jhpiego.org', password: 'password1', role: 'requester' },
            { email: 'MLichaba@jhpiego.org', password: 'password2', role: 'requester' },
            { email: 'TMokhele@jhpiego.org', password: 'password3', role: 'requester' },
            { email: 'FleetManager@jhpiego.org', password: 'managerpassword', role: 'fleet_manager' }
        ];

        // Sample drivers for the system
        const drivers = [
            'Driver 1',
            'Driver 2',
            'Driver 3'
        ];

        // State management for logged-in user and vehicles
        let loggedInUser = null;
        let vehicles = JSON.parse(localStorage.getItem('vehicles')) || [];

        // Load users and drivers into dropdowns
        window.onload = () => {
            const userDropdown = document.getElementById('userDropdown');
            users.forEach(user => {
                if (user.role === 'requester') {
                    let option = document.createElement('option');
                    option.value = user.email;
                    option.innerText = user.email;
                    userDropdown.appendChild(option);
                }
            });

            const driverDropdown = document.getElementById('driverDropdown');
            drivers.forEach(driver => {
                let option = document.createElement('option');
                option.value = driver;
                option.innerText = driver;
                driverDropdown.appendChild(option);
            });

            renderVehicles();
        };

        // Login function
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                loggedInUser = user;
                document.getElementById('loginDiv').style.display = 'none';
                document.getElementById('mainDiv').style.display = 'block';

                if (user.role === 'fleet_manager') {
                    document.getElementById('mainDiv').classList.add('fleet-manager');
                } else {
                    document.getElementById('mainDiv').classList.remove('fleet-manager');
                }
            } else {
                alert('Invalid email or password');
            }
        }

        // Logout function
        function logout() {
            loggedInUser = null;
            document.getElementById('loginDiv').style.display = 'block';
            document.getElementById('mainDiv').style.display = 'none';
        }

        // Function to render vehicles in the table
        function renderVehicles() {
            const tbody = document.querySelector('#vehicleTable tbody');
            tbody.innerHTML = '';
            vehicles.forEach((vehicle, index) => {
                const tr = document.createElement('tr');

                tr.innerHTML = `
                    <td>${vehicle.name}</td>
                    <td>${vehicle.driver}</td>
                    <td>${vehicle.startDate}</td>
                    <td>${vehicle.startTime}</td>
                    <td>${vehicle.endDate}</td>
                    <td>${vehicle.endTime}</td>
                    <td>
                        <select onchange="updateAssignedUser(${index}, this.value)">
                            ${users.filter(user => user.role === 'requester').map(user => `<option value="${user.email}" ${user.email === vehicle.assignedTo ? 'selected' : ''}>${user.email}</option>`).join('')}
                        </select>
                    </td>
                    <td>
                        <button onclick="editVehicle(${index})">Edit</button>
                        <button onclick="deleteVehicle(${index})">Delete</button>
                    </td>
                `;

                tbody.appendChild(tr);
            });
        }

        // Function to add a new vehicle
        function addVehicle() {
            const vehicleName = document.getElementById('vehicleName').value;
            const driver = document.getElementById('driverDropdown').value;
            const startDate = document.getElementById('startDate').value;
            const startTime = document.getElementById('startTime').value;
            const endDate = document.getElementById('endDate').value;
            const endTime = document.getElementById('endTime').value;
            const assignedTo = document.getElementById('userDropdown').value;

            if (vehicleName && driver && startDate && startTime && endDate && endTime && assignedTo) {
                vehicles.push({
                    name: vehicleName,
                    driver: driver,
                    startDate: startDate,
                    startTime: startTime,
                    endDate: endDate,
                    endTime: endTime,
                    assignedTo: assignedTo
                });
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                renderVehicles();
            } else {
                alert('Please fill out all fields.');
            }
        }

        // Function to update the assigned user
        function updateAssignedUser(index, user) {
            vehicles[index].assignedTo = user;
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
        }

        // Function to edit an existing vehicle
        function editVehicle(index) {
            const vehicle = vehicles[index];
            document.getElementById('vehicleName').value = vehicle.name;
            document.getElementById('driverDropdown').value = vehicle.driver;
            document.getElementById('startDate').value = vehicle.startDate;
            document.getElementById('startTime').value = vehicle.startTime;
            document.getElementById('endDate').value = vehicle.endDate;
            document.getElementById('endTime').value = vehicle.endTime;
            document.getElementById('userDropdown').value = vehicle.assignedTo;

            // Remove the old entry
            deleteVehicle(index);
        }

        // Function to delete a vehicle
        function deleteVehicle(index) {
            vehicles.splice(index, 1);
            localStorage.setItem('vehicles', JSON.stringify(vehicles));
            renderVehicles();
        }
    </script>

</body>
</html>
