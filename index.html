<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jhpiego Vehicle Management System</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #ffffff;
        margin: 0;
        padding: 20px;
      }
      .header {
        display: flex;
        align-items: center;
      }
      .header img {
        width: auto;
        height: auto;
        margin-right: 35px;
      }
      .header h1 {
        margin: 0;
        color: #000000;
      }
      form,
      .section {
        margin-bottom: 20px;
        padding: 20px;
        background-color: #f2f2f2;
        border-radius: 25px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      input,
      button,
      select {
        margin: 5px 0;
        padding: 10px;
        width: 100%;
        border: 1px solid #efefef;
        border-radius: 5px;
        box-sizing: border-box;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      table,
      th,
      td {
        border: 1px solid #ddd;
      }
      th,
      td {
        padding: 10px;
        text-align: left;
      }
      button {
        background-color: #016a63;
        color: white;
        cursor: pointer;
      }
      button:hover {
        background-color: #039b91;
      }
      .button-group button {
        width: auto;
        margin-right: 5px;
      }
      .hidden {
        display: none;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
  </head>
  <body>
    <div class="header">
      <img src="jhpiego_logo.png" alt="Jhpiego Logo" />
      <h1>Jhpiego Vehicle Management System</h1>
    </div>

    <!-- Login Form -->
    <form id="loginForm">
      <input type="email" id="email" placeholder="Enter your email" required />
      <input
        type="password"
        id="password"
        placeholder="Enter your password"
        required
      />
      <button type="submit">Login</button>
    </form>

    <button id="logoutButton" class="hidden">Logout</button>

    <!-- Admin Section -->
    <div id="adminSection" class="hidden">
      <!-- Add Vehicle Form -->
      <div class="section">
        <h2>Add New Vehicle</h2>
        <form id="addVehicleForm">
          <input
            type="text"
            id="vehicleMake"
            placeholder="Vehicle Make"
            required
          />
          <input
            type="text"
            id="vehicleModel"
            placeholder="Vehicle Model"
            required
          />
          <input
            type="text"
            id="vehicleRegistration"
            placeholder="Vehicle Registration"
            required
          />
          <select id="projectName" required>
            <option value="" disabled selected> Select Project</option>
            <option value="CUT-TB">CUT-TB</option>
            <option value="MOSAIC">MOSAIC</option>
            <option value="RISE">RISE</option>
            <option value="MATRIX">MATRIX</option>
          </select>
          <input type="date" id="startDate" placeholder="Start Date" required />
          <input type="time" id="startTime" placeholder="Start Time" required />
          <input type="date" id="endDate" placeholder="End Date" required />
          <input type="time" id="endTime" placeholder="End Time" required />
          <button type="submit">Add Vehicle</button>
        </form>
      </div>

      <!-- Vehicle List with Driver Assignment -->
      <div class="section">
        <h2>Vehicle List</h2>
        <table id="adminVehicleTable">
          <thead>
            <tr>
              <th>Make</th>
              <th>Model</th>
              <th>Registration</th>
              <th>Project</th>
              <th>Start Date</th>
              <th>Start Time</th>
              <th>End Date</th>
              <th>End Time</th>
              <th>Driver</th>
              <th>Assigned To</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Vehicles will be populated here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- User Section -->
    <div id="userSection" class="hidden">
      <!-- Available Vehicles -->
      <div class="section">
        <h2>Available Vehicles</h2>
        <table id="userVehicleTable">
          <thead>
            <tr>
              <th>Make</th>
              <th>Model</th>
              <th>Registration</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Available vehicles will be populated here -->
          </tbody>
        </table>
      </div>

      <!-- My Requests -->
      <div class="section">
        <h2>My Requests</h2>
        <table id="myRequestsTable">
          <thead>
            <tr>
              <th>Vehicle</th>
              <th>Status</th>
              <th>Assigned Driver</th>
              <th>Start Date</th>
              <th>End Date</th>
            </tr>
          </thead>
          <tbody>
            <!-- User's requests will be populated here -->
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      // Data Structures
      const vehicles = JSON.parse(localStorage.getItem("vehicles")) || [];
      const requests = JSON.parse(localStorage.getItem("requests")) || [];
      const users = [
        { email: "TMokitimi@jhpiego.org", role: "user" },
        { email: "MMatete@jhpiego.org", role: "user" },
        { email: "TNtelane@jhpiego.org", role: "user" },
        { email: "SMpalami@jhpiego.org", role: "user" },
        { email: "MShoba@jhpiego.org", role: "user" },
        { email: "TMolapo@jhpiego.org", role: "user" },
        { email: "RSoothoane@jhpiego.org", role: "user" },
        { email: "PMoshoeshoe@jhpiego.org", role: "user" },
        { email: "MTuoane@jhpiego.org", role: "user" },
        { email: "MNkongoane@jhpiego.org", role: "user" },
        { email: "fleetmanager@jhpiego.org", role: "fleetManager" },
      ];
      let currentUser = { email: "", role: "" };

      // Utility Functions
      function generateId() {
        return "_" + Math.random().toString(36).substr(2, 9);
      }

      // Initialize the system
      function initialize() {
        populateAdminVehicleTable();
        populateUserVehicleTable();
        populateMyRequestsTable();
      }

      // Login Handling
      const loginForm = document.getElementById("loginForm");
      const adminSection = document.getElementById("adminSection");
      const userSection = document.getElementById("userSection");
      const logoutButton = document.getElementById("logoutButton");

      loginForm.addEventListener("submit", function (event) {
        event.preventDefault();
        const emailInput = document.getElementById("email").value.trim();
        const passwordInput = document.getElementById("password").value.trim();

        if (!emailInput.endsWith("@jhpiego.org")) {
          alert("Only @jhpiego.org emails are allowed.");
          return;
        }

        currentUser.email = emailInput;
        const user = users.find((u) => u.email === emailInput);

        if (!user || passwordInput !== "password") {
          alert("Invalid credentials.");
          return;
        }

        currentUser.role = user.role;
        if (currentUser.role === "fleetManager") {
          adminSection.classList.remove("hidden");
          userSection.classList.add("hidden");
          populateAdminVehicleTable();
        } else {
          userSection.classList.remove("hidden");
          adminSection.classList.add("hidden");
          populateUserVehicleTable();
          populateMyRequestsTable();
        }

        loginForm.classList.add("hidden");
        logoutButton.classList.remove("hidden");
      });

      // Logout Handling
      logoutButton.addEventListener("click", function () {
        currentUser = { email: "", role: "" };
        loginForm.reset();
        loginForm.classList.remove("hidden");
        adminSection.classList.add("hidden");
        userSection.classList.add("hidden");
        logoutButton.classList.add("hidden");
      });

      // Populate Admin Vehicle Table
      function populateAdminVehicleTable() {
        const tableBody = document.querySelector("#adminVehicleTable tbody");
        tableBody.innerHTML = "";

        vehicles.forEach((vehicle, index) => {
          const row = document.createElement("tr");

          const makeCell = document.createElement("td");
          makeCell.textContent = vehicle.make;
          row.appendChild(makeCell);

          const modelCell = document.createElement("td");
          modelCell.textContent = vehicle.model;
          row.appendChild(modelCell);

          const registrationCell = document.createElement("td");
          registrationCell.textContent = vehicle.registration;
          row.appendChild(registrationCell);

          const projectCell = document.createElement("td");
          projectCell.textContent = vehicle.project;
          row.appendChild(projectCell);

          const startDateCell = document.createElement("td");
          startDateCell.textContent = vehicle.startDate;
          row.appendChild(startDateCell);

          const startTimeCell = document.createElement("td");
          startTimeCell.textContent = vehicle.startTime;
          row.appendChild(startTimeCell);

          const endDateCell = document.createElement("td");
          endDateCell.textContent = vehicle.endDate;
          row.appendChild(endDateCell);

          const endTimeCell = document.createElement("td");
          endTimeCell.textContent = vehicle.endTime;
          row.appendChild(endTimeCell);

          const driverCell = document.createElement("td");
          const driverSelect = document.createElement("select");

          ["", "Driver 1", "Driver 2", "Driver 3"].forEach((driver) => {
            const option = document.createElement("option");
            option.value = driver;
            option.textContent = driver;
            driverSelect.appendChild(option);
          });

          driverSelect.value = vehicle.driver || "";
          driverSelect.addEventListener("change", function () {
            vehicles[index].driver = driverSelect.value;
            localStorage.setItem("vehicles", JSON.stringify(vehicles));
          });

          driverCell.appendChild(driverSelect);
          row.appendChild(driverCell);

          const assignedToCell = document.createElement("td");
          const assignedToSelect = document.createElement("select");

          users.forEach((user) => {
            const option = document.createElement("option");
            option.value = user.email;
            option.textContent = user.email;
            assignedToSelect.appendChild(option);
          });

          assignedToSelect.value = vehicle.assignedTo || "";
          assignedToSelect.addEventListener("change", function () {
            vehicles[index].assignedTo = assignedToSelect.value;
            localStorage.setItem("vehicles", JSON.stringify(vehicles));
          });

          assignedToCell.appendChild(assignedToSelect);
          row.appendChild(assignedToCell);

          const actionsCell = document.createElement("td");
          const editButton = document.createElement("button");
          editButton.textContent = "Edit";
          editButton.addEventListener("click", function () {
            editVehicle(index);
          });

          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete";
          deleteButton.addEventListener("click", function () {
            deleteVehicle(index);
          });

          actionsCell.appendChild(editButton);
          actionsCell.appendChild(deleteButton);
          row.appendChild(actionsCell);

          tableBody.appendChild(row);
        });
      }

      // Populate User Vehicle Table
      function populateUserVehicleTable() {
        const tableBody = document.querySelector("#userVehicleTable tbody");
        tableBody.innerHTML = "";

        vehicles.forEach((vehicle, index) => {
          const row = document.createElement("tr");

          const makeCell = document.createElement("td");
          makeCell.textContent = vehicle.make;
          row.appendChild(makeCell);

          const modelCell = document.createElement("td");
          modelCell.textContent = vehicle.model;
          row.appendChild(modelCell);

          const registrationCell = document.createElement("td");
          registrationCell.textContent = vehicle.registration;
          row.appendChild(registrationCell);

          const actionsCell = document.createElement("td");
          const requestButton = document.createElement("button");
          requestButton.textContent = "Request";
          requestButton.addEventListener("click", function () {
            requestVehicle(index);
          });

          actionsCell.appendChild(requestButton);
          row.appendChild(actionsCell);

          tableBody.appendChild(row);
        });
      }

      // Populate My Requests Table
      function populateMyRequestsTable() {
        const tableBody = document.querySelector("#myRequestsTable tbody");
        tableBody.innerHTML = "";

        requests.forEach((request) => {
          if (request.userEmail !== currentUser.email) return;

          const row = document.createElement("tr");

          const vehicleCell = document.createElement("td");
          vehicleCell.textContent = `${request.vehicleMake} ${request.vehicleModel}`;
          row.appendChild(vehicleCell);

          const statusCell = document.createElement("td");
          statusCell.textContent = request.status;
          row.appendChild(statusCell);

          const assignedDriverCell = document.createElement("td");
          assignedDriverCell.textContent = request.assignedDriver || "Pending";
          row.appendChild(assignedDriverCell);

          const startDateCell = document.createElement("td");
          startDateCell.textContent = request.startDate;
          row.appendChild(startDateCell);

          const endDateCell = document.createElement("td");
          endDateCell.textContent = request.endDate;
          row.appendChild(endDateCell);

          tableBody.appendChild(row);
        });
      }

      // Add New Vehicle
      const addVehicleForm = document.getElementById("addVehicleForm");

      addVehicleForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const newVehicle = {
          id: generateId(),
          make: document.getElementById("vehicleMake").value,
          model: document.getElementById("vehicleModel").value,
          registration: document.getElementById("vehicleRegistration").value,
          project: document.getElementById("projectName").value,
          startDate: document.getElementById("startDate").value,
          startTime: document.getElementById("startTime").value,
          endDate: document.getElementById("endDate").value,
          endTime: document.getElementById("endTime").value,
          driver: "",
          assignedTo: "",
        };

        vehicles.push(newVehicle);
        localStorage.setItem("vehicles", JSON.stringify(vehicles));

        addVehicleForm.reset();
        populateAdminVehicleTable();
      });

      // Request Vehicle
      function requestVehicle(vehicleIndex) {
        const vehicle = vehicles[vehicleIndex];
        const newRequest = {
          id: generateId(),
          userEmail: currentUser.email,
          vehicleMake: vehicle.make,
          vehicleModel: vehicle.model,
          vehicleRegistration: vehicle.registration,
          status: "Pending",
          startDate: vehicle.startDate,
          endDate: vehicle.endDate,
        };

        requests.push(newRequest);
        localStorage.setItem("requests", JSON.stringify(requests));
        populateMyRequestsTable();
      }

      // Edit Vehicle
      function editVehicle(vehicleIndex) {
        const vehicle = vehicles[vehicleIndex];
        document.getElementById("vehicleMake").value = vehicle.make;
        document.getElementById("vehicleModel").value = vehicle.model;
        document.getElementById("vehicleRegistration").value = vehicle.registration;
        document.getElementById("projectName").value = vehicle.project;
        document.getElementById("startDate").value = vehicle.startDate;
        document.getElementById("startTime").value = vehicle.startTime;
        document.getElementById("endDate").value = vehicle.endDate;
        document.getElementById("endTime").value = vehicle.endTime;

        vehicles.splice(vehicleIndex, 1);
        populateAdminVehicleTable();
      }

      // Delete Vehicle
      function deleteVehicle(vehicleIndex) {
        vehicles.splice(vehicleIndex, 1);
        localStorage.setItem("vehicles", JSON.stringify(vehicles));
        populateAdminVehicleTable();
      }

      $(function () {
        $("#startDate").datepicker();
        $("#endDate").datepicker();
      });

      initialize();
    </script>
  </body>
</html>
